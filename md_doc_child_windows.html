<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>duilib自学教程: 创建子窗口</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">duilib自学教程
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">创建子窗口 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>一个大规模的应用不可能只有一个窗口，之前我们的案例都是在一个窗口实现的，接下来我们实现一个关于窗口，来介绍如何通过 <a class="el" href="namespace_dui_lib.html">DuiLib</a> 实现子窗口管理。</p>
<h1>创建子窗口 XML 配置文件</h1>
<p>前面我们已经做了很多 XML 的案例了，所以这里就不多说了，直接将写好的 XML 贴上来给大家做一下简单分析，然后直接使用。</p>
<div class="fragment"><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div>
<div class="line">&lt;Window size=&quot;480,360&quot; caption=&quot;0,0,0,35&quot;&gt;</div>
<div class="line">    &lt;Font shared=&quot;true&quot; id=&quot;1&quot; name=&quot;微软雅黑&quot; size=&quot;14&quot; /&gt;</div>
<div class="line">    &lt;VerticalLayout&gt;</div>
<div class="line">        &lt;!-- 标题栏 --&gt;</div>
<div class="line">        &lt;HorizontalLayout height=&quot;35&quot; bkcolor=&quot;#FFD6DBE9&quot; inset=&quot;8,8,8,0&quot;&gt;</div>
<div class="line">            &lt;HorizontalLayout width=&quot;185&quot;&gt;</div>
<div class="line">                &lt;Control bkimage=&quot;logo.png&quot; height=&quot;18&quot; width=&quot;18&quot; /&gt;</div>
<div class="line">                &lt;Label text=&quot;关于&quot; height=&quot;18&quot; padding=&quot;8&quot; font=&quot;1&quot;/&gt;</div>
<div class="line">            &lt;/HorizontalLayout&gt;</div>
<div class="line">            &lt;Control /&gt;</div>
<div class="line">            &lt;HorizontalLayout width=&quot;18&quot;&gt;</div>
<div class="line">                &lt;Button name=&quot;btn_close&quot; height=&quot;18&quot; width=&quot;18&quot; normalimage=&quot;btn_close_normal.png&quot; hotimage=&quot;btn_close_hovered.png&quot; pushedimage=&quot;btn_close_pushed.png&quot; /&gt;</div>
<div class="line">            &lt;/HorizontalLayout&gt;</div>
<div class="line">        &lt;/HorizontalLayout&gt;</div>
<div class="line">        &lt;HorizontalLayout bkcolor=&quot;#FFFFFFFF&quot;&gt;</div>
<div class="line">            &lt;Label align=&quot;center&quot; text=&quot;duilib tutorial, created by jiajia_deng&quot; /&gt;</div>
<div class="line">        &lt;/HorizontalLayout&gt;</div>
<div class="line">    &lt;/VerticalLayout&gt;</div>
<div class="line">&lt;/Window&gt;</div>
</div><!-- fragment --><p>窗口还是保留标题栏，但只有一个关闭按钮了，并且关闭按钮的名字我修改成了 btn_close，目的就是不想让窗口走默认的关闭流程。窗口中只有一个 Label 显示了一串文字（毕竟这不是重点）。然后我们需要新建一个类，与 MainWndFrame 窗口一样，继承 WindowImplBase 实现各个虚函数。如下所示：</p>
<div class="fragment"><div class="line">#pragma once</div>
<div class="line">class AboutWndFrame : public WindowImplBase</div>
<div class="line">{</div>
<div class="line">protected:</div>
<div class="line">    virtual CDuiString GetSkinFolder() override;                // 获取皮肤文件的目录，如果有多层目录这里可以设置</div>
<div class="line">    virtual CDuiString GetSkinFile() override;                  // 设置皮肤文件名字</div>
<div class="line">    virtual LPCTSTR GetWindowClassName(void) const override;    // 设置当前窗口的 class name</div>
<div class="line"> </div>
<div class="line">    virtual UILIB_RESOURCETYPE GetResourceType() const override;// 返回资源类型</div>
<div class="line">    virtual LPCTSTR GetResourceID() const override;             // 如果是ZIP资源，返回资源ID</div>
<div class="line"> </div>
<div class="line">    virtual void InitWindow() override;                         // 窗口初始化函数</div>
<div class="line">    virtual void Notify(TNotifyUI&amp; msg) override;               // 通知事件处理函数</div>
<div class="line"> </div>
<div class="line">public:</div>
<div class="line">    static const LPCTSTR    kClassName;</div>
<div class="line">    static const LPCTSTR    kAboutWndFrame;</div>
<div class="line"> </div>
<div class="line">private:</div>
<div class="line">    CButtonUI*              m_pCloseBtn = nullptr;</div>
<div class="line">};</div>
</div><!-- fragment --><p>各个接口的实现我就不在这里贴代码了，大家可以看提交的 Demo 代码。随后在 main_wnd_frame.xml 中，增加一个关于按钮到最小化按钮左边。</p>
<div class="fragment"><div class="line">&lt;HorizontalLayout childpadding=&quot;3&quot; width=&quot;81&quot;&gt;</div>
<div class="line">  &lt;Button name=&quot;aboutbtn&quot; height=&quot;18&quot; width=&quot;18&quot; normalimage=&quot;btn_about_normal.png&quot; hotimage=&quot;btn_about_hovered.png&quot; pushedimage=&quot;btn_about_pushed.png&quot; /&gt;</div>
<div class="line">  &lt;Button name=&quot;minbtn&quot; height=&quot;18&quot; width=&quot;18&quot; normalimage=&quot;btn_min_normal.png&quot; hotimage=&quot;btn_min_hovered.png&quot; pushedimage=&quot;btn_min_pushed.png&quot; /&gt;</div>
<div class="line">  ....</div>
<div class="line">&lt;/HorizontalLayout&gt;</div>
</div><!-- fragment --><p>此时主窗口就会显示一个关于按钮了，注意我们也修改了父容器的宽度，因为比之前多了一个按钮，我们要算上按钮宽度和间距增大父容器的宽度。</p>
<p><img src="2018-05-03_16-06-52.png" alt="" class="inline"/></p>
<p>接下来做关于按钮的响应，首先添加一个按钮的成员变量来接收关于按钮，然后再 inlucde 关于窗口的头文件 <code>AboutWndFrame.h</code>，并添加一个窗口的成员变量 <code>m_pAboutWndFrame</code>。重载 OnClick 方法判断当前点击的是否是关于按钮，如果是那么就显示关于窗口。代码如下：</p>
<div class="fragment"><div class="line">void MainWndFrame::OnClick(TNotifyUI&amp; msg)</div>
<div class="line">{</div>
<div class="line">    CDuiString strName = msg.pSender-&gt;GetName();</div>
<div class="line">    if (strName == _T(&quot;aboutbtn&quot;))</div>
<div class="line">    {</div>
<div class="line">        if (m_pAboutWndFrame == nullptr)</div>
<div class="line">        {</div>
<div class="line">            m_pAboutWndFrame = new AboutWndFrame();</div>
<div class="line">            m_pAboutWndFrame-&gt;Create(this-&gt;GetHWND(), AboutWndFrame::kClassName, UI_WNDSTYLE_DIALOG, 0);</div>
<div class="line">        }</div>
<div class="line">        m_pAboutWndFrame-&gt;CenterWindow();</div>
<div class="line">        m_pAboutWndFrame-&gt;ShowWindow();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    __super::OnClick(msg);</div>
<div class="line">}</div>
</div><!-- fragment --><p>这里有个小技巧就是判断窗口是不是 nullptr，如果是 nullptr 就全新 new 一个 AboutWndFrame，如果是有效的指针则直接显示窗口。在 AboutWndFrame 中在关闭窗口时，只需要激活父窗口然后把自己隐藏掉就可以了。如下所示：</p>
<div class="fragment"><div class="line">void AboutWndFrame::Notify(TNotifyUI&amp; msg)</div>
<div class="line">{</div>
<div class="line">    if (msg.sType == DUI_MSGTYPE_CLICK)</div>
<div class="line">    {</div>
<div class="line">        CDuiString strName = msg.pSender-&gt;GetName();</div>
<div class="line">        if (strName == _T(&quot;btn_close&quot;))</div>
<div class="line">        {</div>
<div class="line">            HWND hWndParent = GetWindowOwner(m_hWnd);</div>
<div class="line">            if (hWndParent)</div>
<div class="line">            {</div>
<div class="line">                ::EnableWindow(hWndParent, TRUE);</div>
<div class="line">                ::SetFocus(hWndParent);</div>
<div class="line">            }</div>
<div class="line">            ShowWindow(false);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><img src="2018-05-03_16-48-30.png" alt="" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者 &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
